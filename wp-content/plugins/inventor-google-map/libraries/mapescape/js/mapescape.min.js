(function(a){MapEscape=function(d,c){var e=this,b=a(d);a.extend(e,{mapWrapperCssClass:"map-wrapper",scrollAreaCssClass:"mapescape-scroll",scrollTabCssClass:"mapescape-scroll-tab",helperCSSClass:"scroll-active",init:function(){this.initScrollHelper();var f="";if(c.scrollFollow){f="scroll "}a(window).on(f+"resize orientationchange",a.proxy(this,"toggleScrollHelperOn"))},initScrollHelper:function(){this.$scrollHelper=a('<div class="'+this.scrollAreaCssClass+" "+c.hiddenClass+'"></div>');this.$scrollHelperTab=a('<div class="'+this.scrollTabCssClass+'"></div>');if(c.scrollText){this.$scrollHelperTab.text(c.scrollText)}this.addScrollHelper()},addScrollHelper:function(){b.wrap('<div class="'+this.mapWrapperCssClass+'"></div>');this.$scrollHelper.insertAfter(b);this.$scrollHelper.html(this.$scrollHelperTab);this.mapControls=this.$scrollHelper.css("top");if(this.mapControls==="auto"){this.mapControls=0;this.$scrollHelper.css({top:"0"})}var f=b.height();if(!typeof Zepto==="undefined"){f=b.outerHeight()}this.mapHeight=(f-parseInt(this.mapControls));this.$scrollHelper.height(this.mapHeight);this.$scrollHelper.on("touchstart mousedown",a.proxy(this,"touchstartHandler"));this.$scrollHelper.on("touchend mouseup",a.proxy(this,"touchendHandler"));if(c.tabCenter){this.positionScrollTab()}this.toggleScrollHelperOn()},positionScrollTab:function(){this.tabHeight=this.$scrollHelperTab.height();if(!typeof Zepto==="undefined"){this.tabHeight=this.$scrollHelperTab.outerHeight()}this.pos=(this.mapHeight/2)-(this.tabHeight/2);this.$scrollHelperTab.css({top:this.pos+"px"})},checkMapVsWindow:function(){var g=a(window).height(),l=a(window).scrollTop(),f=b.offset().top-l,j=f+(this.mapHeight+parseInt(this.mapControls));if(f<=0){var k=((this.mapHeight-f)/2)-(this.tabHeight/2);if(k+(this.tabHeight)>this.mapHeight){this.pos=this.mapHeight-this.tabHeight}else{this.pos=k}}if(j>g){var i=(f+this.mapHeight)-g,k=((this.mapHeight-i)/2)-(this.tabHeight/2);if(k<0){this.pos=0}else{this.pos=k}}if(f<0&&j>g){var k=(Math.abs(f))+(g/2)-(this.tabHeight/2);this.pos=k}this.$scrollHelperTab.css({top:this.pos+"px"})},toggleScrollHelperOn:function(){if(c.alwaysOn){this.showScrollHelper();return}this.checkMapVsWindow();var g=(b.offset().top+(this.mapHeight+parseInt(this.mapControls)))+c.threshhold;var f=a(window).height();if(!typeof Zepto==="undefined"){f=a(window).innerHeight()}if(g>f){this.showScrollHelper()}else{this.removeScrollHelper()}},removeScrollHelper:function(){this.$scrollHelper.addClass(c.hiddenClass)},showScrollHelper:function(){this.$scrollHelper.removeClass(c.hiddenClass)},touchstartHandler:function(f){a(f.currentTarget).addClass(this.helperCSSClass)},touchendHandler:function(f){a(f.currentTarget).removeClass(this.helperCSSClass)}});e.init()};a.fn.mapescape=function(b){return this.each(function(){var d=a(this),c={alwaysOn:false,hiddenClass:"scroll-inactive",scrollText:null,threshhold:0,tabCenter:true,scrollFollow:true};if(b){a.extend(c,b)}new MapEscape(d,c)})}})(window.jQuery||window.Zepto);